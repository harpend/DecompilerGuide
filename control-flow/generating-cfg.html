<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Decompiler Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </head>
  <body data-bs-theme="dark">
    <div class="container">
        <div class="row">
            <h1 class="mt-3 text-center">Decompiler Guide</h1>
            <hr>
            <div class="col-md-4">
                <div class="row">
                    <div class="list-group">
                        <a href="../index.html" class="list-group-item list-group-item-action">Home</a>
                        <a href="../overview.html" class="list-group-item list-group-item-action">Overview of Decompilers</a>
                        <a href="../disassembling.html" class="list-group-item list-group-item-action">Disassembling</a>
                        <a href="../control-flow.html" class="list-group-item list-group-item-action">Control Flow Graph</a>
                        <a href="#!" class="list-group-item list-group-item-action">Structuring</a>
                        <a href="#!" class="list-group-item list-group-item-action">Data Flow Analysis</a>
                        <a href="#!" class="list-group-item list-group-item-action">Statements and Expressions</a>
                        <a href="#!" class="list-group-item list-group-item-action">Code Generation</a>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <p>Leader - first instruction in a BB.</p>
                    <p>Terminator - last instruction in a BB.</p>
                </div>
            </div>
            <div class="col">
        
                <h2>Generating Control Flow Graphs</h2>
                <hr>
                <p>In this article I will introduce the steps required in order to build a control flow graph.</p>
                <p>As a reminder from the architecture document Control Flow Graphs (CFGs) are a way to represent the possible paths of execution a program could take, here is what a simple if-then-else would look like:</p>
                <img src="./images/cfg1.png" width="400" alt="if-then-else control flow graph">
                <p></p>
                <p>The squares represent our nodes containing the code and the arrows represent edges from one set of sequentially executed instructions to another. It should also be noted that a control flow graph has a root. The root is the entry point to the program and when we represent the graph in our decompiler we shall store a pointer to this.</p>
                <p>Here is the data structures for a node (Basic Block) and the graph:</p>
                <img src="./images/cfg-types.png" width="400" alt="Basic Block and CFG Structures">
                <p></p>
                <p>We use lists for the successors and the predecessors due the proportion of edges being small compared to the number of nodes squared. The instruction type is left up to the reader to define based on what is most appropriate for their assembly/bytecode. The options for this are discussed in the disassembly section.</p>
                <p>The next step is to go through the program and generate our CFG. We start with one basic block and identify the Basic Blocks then we create them and link them. Changes in control flow are indicated by branches, calls, returns and in more complicated programs we have function pointers.</p>
                <p>Here is some psuedocode for that:</p>
                <img src="./images/genbbs.png" width="500" alt="psuedocode for generating CFG">
                <p></p>
                
        </div>
    </div>
  </body>
</html>